<html>

<head>
    <link rel="icon" href="./favicon.ico" />
    <meta name="viewport" content="
        width=device-width,
        initial-scale=1.0,
        minimum-scale=1.0,
        maximum-scale=1.0,
        user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="./global.css" />
    <link rel="stylesheet" type="text/css" href="./iconfont/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="./iconfont/iconfont2.css" />
    <style>
        #myCanvas {
            position: absolute;
            width: calc(100% - 100px);
            width: -moz-calc(100% - 100px);
            width: -webkit-calc(100% - 100px);
            height: calc(100% - 80px);
            height: -moz-calc(100% - 80px);
            height: -webkit-calc(100vh - 80px);
            left: 50px;
            top: 40px;
        }

        #myViewCube {
            width: 150px;
            height: 150px;
            position: absolute;
            bottom: 40px;
            right: 50px;
            z-index: 1;
        }

        .top-bar {
            position: absolute;
            display: flex;
            top: 5px;
            left: 50%;
            transform: translate(-50%);
        }

        .top-bar-btn {
            padding: 4px 15px;
            white-space: nowrap;
            text-align: center;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);
            user-select: none;
            color: rgba(0, 0, 0, 0.88);
            background-color: #ffffff;
            border-color: #d9d9d9;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.02);
            margin-inline-end: -1px;
        }

        .top-bar-btn:hover {
            z-index: 2;
            color: #4096ff;
            border-color: #4096ff;
        }

        .top-bar-btn-first {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }

        .top-bar-btn-last {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="myCanvas"></div>
        <div id="myViewCube"></div>
        <div class="top-bar" style="display: none">
            <button class="top-bar-btn top-bar-btn-first top-bar-btn-last" id="exportGltf">Export gltf</button>
        </div>
    </div>
    <script type="importmap">
            {
                "imports": {
                    "@x-viewer/core": "../packages/core/dist/index.esm.js",
                    "@x-viewer/plugins": "../packages/plugins/dist/index.esm.js",
                    "@x-viewer/ui": "../packages/ui/dist/index.esm.js",
                    "@x-viewer/builder": "../packages/builder/dist/index.esm.js"
                }
            }
        </script>
    <script type="module">
        import { Model3d, THREE, Interaction, ViewerEvent, Viewer3d } from "@x-viewer/core";
        import {
            AxisGizmoPlugin,
            BottomBarPlugin,
            ContextMenuPlugin,
            ExportPlugin,
            GroundGridPlugin,
            GroundShadowPlugin,
            MeasurementPlugin,
            ScreenshotPlugin,
            SectionPlugin,
            Settings3dPlugin,
            SkyboxPlugin,
            StatsPlugin,
            ToolbarMenuId,
            Viewer3dDatGuiPlugin,
            Viewer3dToolbarPlugin,
            ViewCubePlugin,
        } from "@x-viewer/plugins";
        import {
            getAssetInfoList,
            initSystemAssets,
            setModelAssetPath,
            loadAsset,
            getAssetInfo,
            updateAnimate,
            playAnimate,
        } from "@x-viewer/builder";
        const language = "en"; // "en" or "cn"
        const viewerCfg = {
            containerId: "myCanvas",
            language,
            enableSpinner: true,
        };
        const viewer = new Viewer3d(viewerCfg);
        // TODO: do not use the spinner in Viewer
        viewer.spinner.increaseJobCount();
        // font file is needed for loading dxf
        // const fontFiles = ["libs/fonts/Microsoft_YaHei_Regular.typeface.json"];
        // const fontFiles = ["./libs/fonts/hztxt.shx", "./libs/fonts/simplex.shx"];
        // await viewer.setFont(fontFiles);
        const menuConfig = {
            [ToolbarMenuId.Settings]: {
                visible: true,
                onActive: () => {
                    console.log("[Toolbar]", "Activate Settings");
                    if (!window.settingsPanel) {
                        window.settingsPanel = new Settings3dPlugin(window.viewer, { language });
                    }
                    window.settingsPanel.show();
                },
                onDeactive: () => {
                    console.log("[Toolbar]", "Deactivate Settings");
                    window.settingsPanel.hide();
                },
                mutexIds: [
                    ToolbarMenuId.Measure,
                    ToolbarMenuId.MeasureDistance,
                    ToolbarMenuId.MeasureArea,
                    ToolbarMenuId.MeasureAngle,
                    ToolbarMenuId.MeasureCoordinate,
                ],
            },
        };
        new AxisGizmoPlugin(viewer);
        new BottomBarPlugin(viewer);
        // new ContextMenuPlugin(viewer);
        const exportPugin = new ExportPlugin(viewer);
        new GroundGridPlugin(viewer, { visible: false });
        new GroundShadowPlugin(viewer);
        new MeasurementPlugin(viewer, { language });
        new ScreenshotPlugin(viewer);
        new SectionPlugin(viewer, { language });
        new SkyboxPlugin(viewer);
        new StatsPlugin(viewer);
        new ViewCubePlugin(viewer, { containerId: "myViewCube", language });
        // new Viewer3dDatGuiPlugin(viewer);
        new Viewer3dToolbarPlugin(viewer, { menuConfig, language });
        // draco decoder path is needed to load draco encoded models.
        // x-viewer js sdk user maintains draco decoder code somewhere, and provides the path here.
        const decoderPath = "libs/draco/gltf/";
        viewer.setDracoDecoderPath(decoderPath);
        async function createServerRoom() {
            // set path
            setModelAssetPath("./assets/");
            initSystemAssets();
            const group = new THREE.Group();
            const walls = [
                {
                    id: "builder.wall",
                    data: [
                        { x: -29.22, y: -18.92 },
                        { x: 27.68, y: -18.92 },
                        { x: 27.68, y: 21.08 },
                        { x: -29.22, y: 21.08 },
                    ],
                    exteriorColor: "#e3e7ed",
                    exteriorTexture: {
                        repeat: [50, 1],
                    },
                    floorTexture: {
                        repeat: [15, 15],
                    },
                    roofTexture: {
                        repeat: [15, 15],
                    },
                    closed: true,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.2,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -20.7, y: 0.9, z: 21.08 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.2,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -20.7, y: 0.9, z: -18.92 },
                        },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: -18.92 },
                        { x: -19.32, y: -15.92 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: 11.21 },
                        { x: 22.37, y: 11.21 },
                        { x: 22.37, y: 0.83 },
                    ],
                    closed: false,
                    children: [
                        {
                            id: "builder.window",
                            width: 7.05,
                            frameColor: 0x333640,
                            position: { x: 0.218733119497804, y: 1.2, z: 11.21 },
                        },
                        {
                            id: "builder.window",
                            width: 9.3,
                            frameColor: 0x333640,
                            position: { x: 16.966050674876196, y: 1.2, z: 11.21 },
                        },
                        {
                            id: "builder.window",
                            width: 4.7091171148899,
                            frameColor: 0x333640,
                            position: { x: -16.628616076650972, y: 1.2, z: 11.21 },
                        },
                        {
                            id: "builder.window",
                            width: 8.400829979159867,
                            frameColor: 0x333640,
                            position: { x: -8.715658491761828, y: 1.2, z: 11.21 },
                        },
                        {
                            id: "builder.window",
                            width: 5.616639519808001,
                            frameColor: 0x333640,
                            position: { x: 7.945301772242469, y: 1.2, z: 11.21 },
                        },
                        {
                            id: "builder.window",
                            width: 8.989436385369619,
                            frameColor: 0x333640,
                            position: { x: 22.37, y: 1.2, z: 5.952598807357291 },
                        },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: -1.27 },
                        { x: -19.32, y: 14.11 },
                    ],
                    interiorTexture: {
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        repeat: [10, 1],
                    },
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -19.32, y: 0.9, z: 12.46 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -19.32, y: 0.9, z: -0.3 },
                        },
                        {
                            id: "builder.window",
                            width: 8.540334046264043,
                            frameColor: 0x333640,
                            position: { x: -19.32, y: 1.2, z: 6.1 },
                            // map: "window/window3.png",
                        },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: 14.11 },
                        { x: -19.32, y: 21.08 },
                    ],
                    interiorTexture: {
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        repeat: [10, 1],
                    },
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: 2.4, y: -15.92 },
                        { x: 2.4, y: -11.78 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -4.38, y: 14.11 },
                        { x: -4.38, y: 21.08 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -22.22, y: 10.67 },
                        { x: -29.22, y: 10.67 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -22.22, y: 0.64 },
                        { x: -29.22, y: 0.64 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -22.22, y: -12.7 },
                        { x: -29.22, y: -12.7 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.glasswall",
                    data: [
                        { x: 11.57, y: 0.83 },
                        { x: 11.57, y: 11.21 },
                    ],
                    interiorTexture: {
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        repeat: [10, 1],
                    },
                    transparent: true,
                    closed: false,
                },
                {
                    id: "builder.glasswall",
                    data: [
                        { x: -19.32, y: 0.83 },
                        { x: -3.9, y: 0.83 },
                    ],
                    interiorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    transparent: true,
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            leftMap: "door/door14-l.png",
                            rightMap: "door/door14-r.png",
                            position: { x: -17.83, y: 0.9, z: 0.83 },
                        },
                    ],
                },
                {
                    id: "builder.glasswall",
                    data: [
                        { x: 2.4, y: -11.78 },
                        { x: 2.4, y: -1.27 },
                    ],
                    interiorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    transparent: true,
                    closed: false,
                },
                {
                    id: "builder.glasswall",
                    data: [
                        { x: -3.9, y: 0.83 },
                        { x: -3.9, y: 11.21 },
                    ],
                    interiorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    transparent: true,
                    closed: false,
                },
                {
                    id: "builder.glasswall",
                    data: [
                        { x: 27.68, y: -1.27 },
                        { x: -19.32, y: -1.27 },
                    ],
                    interiorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    transparent: true,
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -17.43, y: 0.9, z: -1.27 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 1.1, y: 0.9, z: -1.27 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 3.93, y: 0.9, z: -1.27 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 26.41, y: 0.9, z: -1.27 },
                        },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: -15.92 },
                        { x: -19.32, y: -1.27 },
                    ],
                    closed: false,
                    children: [
                        // {
                        //     type: "Window",
                        //     width: 12.77,
                        //     frameColor: 0x333640,
                        //     position: [-19.32, 1.2, -8.351127278429044],
                        //     map: "window/window3.png",
                        // },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: 14.11 },
                        { x: 27.68, y: 14.11 },
                    ],
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -5.66, y: 0.9, z: 14.11 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 9.26, y: 0.9, z: 14.11 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 12.03, y: 0.9, z: 14.11 },
                        },
                    ],
                },
                {
                    id: "builder.glasswall",
                    data: [
                        { x: -3.9, y: 0.83 },
                        { x: 11.57, y: 0.83 },
                        { x: 22.37, y: 0.83 },
                    ],
                    interiorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    exteriorTexture: {
                        // map: assetPath + "wall/glass-wall4.png",
                        repeat: [10, 1],
                    },
                    transparent: true,
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -2.24, y: 0.9, z: 0.83 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 14.8, y: 0.9, z: 0.83 },
                        },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -19.32, y: -15.92 },
                        { x: 27.66, y: -15.92 },
                    ],
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 1.08, y: 0.9, z: -15.92 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: 3.8774448236724686, y: 0.9, z: -15.92 },
                        },
                    ],
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: 10.49, y: 14.11 },
                        { x: 10.49, y: 21.08 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -22.22, y: -8.8 },
                        { x: -29.22, y: -8.8 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -22.22, y: 6.77 },
                        { x: -29.22, y: 6.77 },
                    ],
                    closed: false,
                },
                {
                    id: "builder.wall",
                    data: [
                        { x: -22.22, y: 21.08 },
                        { x: -22.22, y: -18.92 },
                    ],
                    closed: false,
                    children: [
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -22.22, y: 0.9, z: -14.06 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -22.22, y: 0.9, z: -10.45 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -22.22, y: 0.9, z: -1 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -22.22, y: 0.9, z: 5.1 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -22.22, y: 0.9, z: 9.22 },
                        },
                        {
                            id: "builder.doubledoor",
                            width: 1.6,
                            height: 1.8,
                            depth: 0.36,
                            frameColor: 0x333640,
                            position: { x: -22.22, y: 0.9, z: 12.52 },
                        },
                        // {
                        //     type: "Window",
                        //     width: 5,
                        //     frameColor: 0x333640,
                        //     position: [-22.22, 1.2, 17.0],
                        //     map: "window/window3.png",
                        // },
                    ],
                },
            ];
            const racks = [];
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 20; j++) {
                    racks.push({ x: -16.8 + 2.3 * i, y: 1, z: -14.0 + 0.6 * j });
                }
            }
            for (let i = 0; i < 10; i++) {
                for (let j = 0; j < 20; j++) {
                    racks.push({ x: 5.0 + 2.3 * i, y: 1.0, z: -14.0 + 0.6 * j });
                }
            }
            const columns = [
                { x: -22.5, y: 1.35, z: -18.5 },
                { x: -22.5, y: 1.35, z: -8.8 },
                { x: -22.5, y: 1.35, z: 0.72 },
                { x: -22.5, y: 1.35, z: 10.7 },
                { x: -22.5, y: 1.35, z: 20.65 },
                { x: 22.33, y: 1.35, z: 0.9 },
                { x: 11.55, y: 1.35, z: 0.9 },
                { x: -3.9, y: 1.35, z: 0.9 },
                { x: 2.43, y: 1.35, z: -1.27 },
            ];
            for (let i = 0; i < 6; i++) {
                columns.push({ x: -13.8 + 8.2 * i, y: 1.35, z: -18.5 });
                columns.push({ x: -13.8 + 8.2 * i, y: 1.35, z: 20.65 });
            }
            const plants = [
                { x: -19.7, y: 0.1, z: -13.71 },
                { x: -19.7, y: 0.1, z: -8.33 },
                { x: -19.7, y: 0.1, z: -3.05 },
                { x: 25.11, y: 0.1, z: -0.55 },
            ];
            // Create walls
            for (let i = 0; i < walls.length; i++) {
                const item = walls[i];
                const obj = await loadAsset(item.id, item);
                group.add(obj);
            }
            // Create racks
            for (let i = 0; i < racks.length; i++) {
                const position = racks[i];
                const param = {
                    id: "builder.rack",
                    width: 0.6,
                    height: 2.0,
                    depth: 0.8,
                    position,
                    rotation: { x: 0, y: -Math.PI / 2, z: 0 },
                };
                const obj = await loadAsset(param.id, param);
                group.add(obj);
            }
            // Create columns
            for (let i = 0; i < columns.length; i++) {
                const position = columns[i];
                const param = {
                    id: "builder.column",
                    width: 0.6,
                    height: 2.7,
                    depth: 0.6,
                    position,
                };
                const obj = await loadAsset(param.id, param);
                group.add(obj);
            }
            // Create plants
            for (let i = 0; i < plants.length; i++) {
                const position = plants[i];
                const param = {
                    id: "builder.plant",
                    style: "2",
                    position,
                };
                const obj = await loadAsset(param.id, param);
                group.add(obj);
            }
            return group;
        }
        const model = new Model3d({
            modelId: "ServerRoom",
            object: await createServerRoom(),
        });
        const init = async () => {
            viewer.addModel(model);
            model.rootObject.updateWorldMatrix(false, true);
            viewer.spinner.decreaseJobCount();
        };
        init();
        let lastRack;
        class RoomInteraction extends Interaction {
            mouseMoved = false;
            constructor(viewer) {
                super(viewer);
                this.addEvents(["dblclick", "pointerdown", "pointermove", "pointerup"]);
            }

            handle_pointerdown(e) {
                this.mouseMoved = false;
            }

            handle_pointermove(e) {
                this.mouseMoved = true;
            }

            handle_pointerup(e) {
                if (this.mouseMoved) {
                    this.mouseMoved = false;
                    return;
                }
                if (e.button === 2) {
                    // Each right mouse button cancels one interaction
                    if (lastRack) {
                        animateRack(lastRack);
                        lastRack = undefined;
                        return;
                    }
                    if (viewer.hasTransparentObject()) {
                        viewer.clearModelsOpacity();
                        return;
                    }
                    viewer.goToHomeView();
                }
            }

            handle_dblclick(e) {
                const pickData = viewer.pickObject({ x: e.x, y: e.y });
                if (pickData && pickData.object) {
                    console.log(pickData.object);
                    const rackObj = getRack(pickData.object);
                    if (lastRack && lastRack === rackObj) {
                        // click the same rack
                        animateRack(lastRack);
                        lastRack = undefined;
                        return;
                    }
                    if (rackObj) {
                        // restore last rack
                        if (lastRack) {
                            animateRack(lastRack);
                            lastRack = undefined;
                        }

                        const frontDoor = getRackFrontDoor(rackObj);
                        viewer.flyToObjectFront(frontDoor).then(() => {
                            viewer.setOtherObjectsOpacity(rackObj, 0.05);
                            //transparentOthers(rackObj);
                            animateRack(rackObj);
                            lastRack = rackObj;
                        });
                    } else {
                        // viewer.flyToObject(pickData.object);
                        playAnimate(pickData.object);
                    }
                } else {
                    viewer.viewFitAll();
                }
            }
        }

        function getRack(object) {
            if (object.name === "rack") {
                return object;
            } else if (object.parent) {
                return getRack(object.parent);
            }
        }

        function animateRack(rackObj) {
            const frontDoor = getRackFrontDoor(rackObj);
            const backDoor = getRackBackDoor(rackObj);
            playAnimate(frontDoor);
            playAnimate(backDoor);
        }

        function getRackFrontDoor(rackObject) {
            return rackObject.getObjectByName("rack_front_door");
        }
        function getRackBackDoor(rackObject) {
            return rackObject.getObjectByName("rack_back_door");
        }

        viewer.setInteraction(new RoomInteraction(viewer));
        viewer.addEventListener(ViewerEvent.OnAnimate, ({ timeStamp }) => {
            updateAnimate(timeStamp);
            model.rootObject.updateWorldMatrix(false, true);
            viewer.enableRender();
        });
        // For debug
        window.viewer = viewer;

        const exportGltfBtn = document.getElementById("exportGltf");
        exportGltfBtn.addEventListener("click", () => {
            exportPugin.exportGltf("room_server");
        });
    </script>
</body>

</html>